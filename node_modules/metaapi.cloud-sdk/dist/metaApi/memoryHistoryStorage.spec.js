'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _should = require('should');

var _should2 = _interopRequireDefault(_should);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _memoryHistoryStorage = require('./memoryHistoryStorage');

var _memoryHistoryStorage2 = _interopRequireDefault(_memoryHistoryStorage);

var _historyFileManager = require('./historyFileManager');

var _historyFileManager2 = _interopRequireDefault(_historyFileManager);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @test {MemoryHistoryStorage}
 */
describe('MemoryHistoryStorage', () => {

  let storage;
  let testDeal;
  let testOrder;
  let sandbox;

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(async () => {
    sandbox.stub(_historyFileManager2.default.prototype, 'startUpdateJob').returns();
    storage = new _memoryHistoryStorage2.default('accountId');
    testDeal = { id: '37863643', type: 'DEAL_TYPE_BALANCE', magic: 0, time: new Date(100), commission: 0,
      swap: 0, profit: 10000, platform: 'mt5', comment: 'Demo deposit 1' };
    testOrder = { id: '61210463', type: 'ORDER_TYPE_SELL', state: 'ORDER_STATE_FILLED', symbol: 'AUDNZD', magic: 0,
      time: new Date(50), doneTime: new Date(100), currentPrice: 1, volume: 0.01,
      currentVolume: 0, positionId: '61206630', platform: 'mt5', comment: 'AS_AUDNZD_5YyM6KS7Fv:' };
    await storage.clear();
    storage.onConnected('1:ps-mpa-1', 1);
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {MemoryHistoryStorage#loadDataFromDisk}
   */
  it('should load data from the file manager', async () => {
    sandbox.stub(_historyFileManager2.default.prototype, 'getHistoryFromDisk').returns({ deals: [testDeal], historyOrders: [testOrder] });
    await storage.loadDataFromDisk();
    await new _promise2.default(res => setTimeout(res, 50));
    storage.deals.should.match([testDeal]);
    storage.historyOrders.should.match([testOrder]);
  });

  /**
   * @test {MemoryHistoryStorage#updateDiskStorage}
   */
  it('should update disk storage', async () => {
    sandbox.stub(_historyFileManager2.default.prototype, 'updateDiskStorage');
    await storage.updateDiskStorage();
    _sinon2.default.assert.calledOnce(_historyFileManager2.default.prototype.updateDiskStorage);
  });

  /**
   * @test {MemoryHistoryStorage#lastHistoryOrderTime}
   */
  it('should return last history order time', () => {
    storage.onHistoryOrderAdded('1:ps-mpa-1', {});
    storage.onHistoryOrderAdded('1:ps-mpa-1', { doneTime: new Date('2020-01-01T00:00:00.000Z') });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { doneTime: new Date('2020-01-02T00:00:00.000Z') });
    storage.lastHistoryOrderTime().should.match(new Date('2020-01-02T00:00:00.000Z'));
  });

  /**
   * @test {MemoryHistoryStorage#lastDealTime}
   */
  it('should return last history deal time', () => {
    storage.onDealAdded('1:ps-mpa-1', {});
    storage.onDealAdded('1:ps-mpa-1', { time: new Date('2020-01-01T00:00:00.000Z') });
    storage.onDealAdded('1:ps-mpa-1', { time: new Date('2020-01-02T00:00:00.000Z') });
    storage.lastDealTime().should.match(new Date('2020-01-02T00:00:00.000Z'));
  });

  /**
   * @test {MemoryHistoryStorage#deals}
   */
  it('should return saved deals', () => {
    storage.onDealAdded('1:ps-mpa-1', { id: '1', time: new Date('2020-01-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '7', time: new Date('2020-05-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' });
    storage.onDealAdded('1:ps-mpa-1', { id: '8', time: new Date('2020-02-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '6', time: new Date('2020-10-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' });
    storage.onDealAdded('1:ps-mpa-1', { id: '4', time: new Date('2020-02-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '5', time: new Date('2020-06-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' });
    storage.onDealAdded('1:ps-mpa-1', { id: '11', type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '3', time: new Date('2020-09-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' });
    storage.onDealAdded('1:ps-mpa-1', { id: '5', time: new Date('2020-06-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' });
    storage.onDealAdded('1:ps-mpa-1', { id: '2', time: new Date('2020-08-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '10', type: 'DEAL_TYPE_SELL' });
    storage.onDealAdded('1:ps-mpa-1', { id: '12', type: 'DEAL_TYPE_BUY' });
    storage.deals.should.match([{ id: '10', type: 'DEAL_TYPE_SELL' }, { id: '11', type: 'DEAL_TYPE_SELL' }, { id: '12', type: 'DEAL_TYPE_BUY' }, { id: '1', time: new Date('2020-01-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' }, { id: '4', time: new Date('2020-02-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' }, { id: '8', time: new Date('2020-02-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' }, { id: '7', time: new Date('2020-05-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' }, { id: '5', time: new Date('2020-06-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' }, { id: '2', time: new Date('2020-08-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' }, { id: '3', time: new Date('2020-09-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' }, { id: '6', time: new Date('2020-10-01T00:00:00.000Z'), type: 'DEAL_TYPE_BUY' }]);
  });

  /**
   * @test {MemoryHistoryStorage#historyOrders}
   */
  it('should return saved historyOrders', () => {
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '1', doneTime: new Date('2020-01-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '7', doneTime: new Date('2020-05-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_BUY' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '8', doneTime: new Date('2020-02-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '6', doneTime: new Date('2020-10-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_BUY' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '4', doneTime: new Date('2020-02-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '5', doneTime: new Date('2020-06-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_BUY' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '11', type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '3', doneTime: new Date('2020-09-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_BUY' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '5', doneTime: new Date('2020-06-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_BUY' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '2', doneTime: new Date('2020-08-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '10', type: 'ORDER_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '12', type: 'ORDER_TYPE_BUY' });
    storage.historyOrders.should.match([{ id: '10', type: 'ORDER_TYPE_SELL' }, { id: '11', type: 'ORDER_TYPE_SELL' }, { id: '12', type: 'ORDER_TYPE_BUY' }, { id: '1', doneTime: new Date('2020-01-01T00:00:00.000Z'), type: 'ORDER_TYPE_SELL' }, { id: '4', doneTime: new Date('2020-02-01T00:00:00.000Z'), type: 'ORDER_TYPE_SELL' }, { id: '8', doneTime: new Date('2020-02-01T00:00:00.000Z'), type: 'ORDER_TYPE_SELL' }, { id: '7', doneTime: new Date('2020-05-01T00:00:00.000Z'), type: 'ORDER_TYPE_BUY' }, { id: '5', doneTime: new Date('2020-06-01T00:00:00.000Z'), type: 'ORDER_TYPE_BUY' }, { id: '2', doneTime: new Date('2020-08-01T00:00:00.000Z'), type: 'ORDER_TYPE_SELL' }, { id: '3', doneTime: new Date('2020-09-01T00:00:00.000Z'), type: 'ORDER_TYPE_BUY' }, { id: '6', doneTime: new Date('2020-10-01T00:00:00.000Z'), type: 'ORDER_TYPE_BUY' }]);
  });

  /**
   * @test {MemoryHistoryStorage#orderSynchronizationFinished}
   */
  it('should return saved order synchronization status', () => {
    storage.orderSynchronizationFinished.should.be.false();
    storage.onOrderSynchronizationFinished(1);
    storage.orderSynchronizationFinished.should.be.true();
  });

  /**
   * @test {MemoryHistoryStorage#dealSynchronizationFinished}
   */
  it('should return saved deal synchronization status', () => {
    storage._fileManager.updateDiskStorage = sandbox.stub();
    storage.dealSynchronizationFinished.should.be.false();
    storage.onDealSynchronizationFinished(1);
    _sinon2.default.assert.calledOnce(storage._fileManager.updateDiskStorage);
    storage.dealSynchronizationFinished.should.be.true();
  });

  /**
   * @test {MemoryHistoryStorage#reset}
   */
  it('should reset storage', async () => {
    sandbox.stub(storage._fileManager, 'deleteStorageFromDisk');
    storage.onDealAdded('1:ps-mpa-1', { id: '1', time: new Date('2020-01-01T00:00:00.000Z'), type: 'DEAL_TYPE_SELL' });
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '1', doneTime: new Date('2020-01-01T00:00:00.000Z'),
      type: 'ORDER_TYPE_SELL' });
    await storage.clear();
    _sinon2.default.assert.match(storage.deals, []);
    _sinon2.default.assert.match(storage.historyOrders, []);
    _sinon2.default.assert.calledOnce(storage._fileManager.deleteStorageFromDisk);
  });

  /**
   * @test {MemoryHistoryStorage#reset}
   */
  it('should record instance data from multiple streams', async () => {
    storage.onHistoryOrderAdded('1:ps-mpa-1', { id: '2', doneTime: new Date('2020-01-01T00:00:00.000Z') });
    _sinon2.default.assert.match((await storage.lastHistoryOrderTime(1)), new Date('2020-01-01T00:00:00.000Z'));
    storage.onHistoryOrderAdded('1:ps-mpa-2', { id: '3', doneTime: new Date('2020-01-02T00:00:00.000Z') });
    _sinon2.default.assert.match((await storage.lastHistoryOrderTime(1)), new Date('2020-01-02T00:00:00.000Z'));
    storage.onDealAdded('1:ps-mpa-1', { id: '2', time: new Date('2020-01-01T00:00:00.000Z') });
    _sinon2.default.assert.match((await storage.lastDealTime(1)), new Date('2020-01-01T00:00:00.000Z'));
    storage.onDealAdded('1:ps-mpa-2', { id: '3', time: new Date('2020-01-02T00:00:00.000Z') });
    _sinon2.default.assert.match((await storage.lastDealTime(1)), new Date('2020-01-02T00:00:00.000Z'));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9tZXRhQXBpL21lbW9yeUhpc3RvcnlTdG9yYWdlLnNwZWMuZXM2Il0sIm5hbWVzIjpbImRlc2NyaWJlIiwic3RvcmFnZSIsInRlc3REZWFsIiwidGVzdE9yZGVyIiwic2FuZGJveCIsImJlZm9yZSIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImJlZm9yZUVhY2giLCJzdHViIiwiSGlzdG9yeUZpbGVNYW5hZ2VyIiwicHJvdG90eXBlIiwicmV0dXJucyIsIk1lbW9yeUhpc3RvcnlTdG9yYWdlIiwiaWQiLCJ0eXBlIiwibWFnaWMiLCJ0aW1lIiwiRGF0ZSIsImNvbW1pc3Npb24iLCJzd2FwIiwicHJvZml0IiwicGxhdGZvcm0iLCJjb21tZW50Iiwic3RhdGUiLCJzeW1ib2wiLCJkb25lVGltZSIsImN1cnJlbnRQcmljZSIsInZvbHVtZSIsImN1cnJlbnRWb2x1bWUiLCJwb3NpdGlvbklkIiwiY2xlYXIiLCJvbkNvbm5lY3RlZCIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJpdCIsImRlYWxzIiwiaGlzdG9yeU9yZGVycyIsImxvYWREYXRhRnJvbURpc2siLCJyZXMiLCJzZXRUaW1lb3V0Iiwic2hvdWxkIiwibWF0Y2giLCJ1cGRhdGVEaXNrU3RvcmFnZSIsImFzc2VydCIsImNhbGxlZE9uY2UiLCJvbkhpc3RvcnlPcmRlckFkZGVkIiwibGFzdEhpc3RvcnlPcmRlclRpbWUiLCJvbkRlYWxBZGRlZCIsImxhc3REZWFsVGltZSIsIm9yZGVyU3luY2hyb25pemF0aW9uRmluaXNoZWQiLCJiZSIsImZhbHNlIiwib25PcmRlclN5bmNocm9uaXphdGlvbkZpbmlzaGVkIiwidHJ1ZSIsIl9maWxlTWFuYWdlciIsImRlYWxTeW5jaHJvbml6YXRpb25GaW5pc2hlZCIsIm9uRGVhbFN5bmNocm9uaXphdGlvbkZpbmlzaGVkIiwiZGVsZXRlU3RvcmFnZUZyb21EaXNrIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FB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RCxJQUFJN0IsSUFBSixDQUFTLDBCQUFULENBQTFEO0FBQ0FqQixZQUFRK0MsV0FBUixDQUFvQixZQUFwQixFQUFrQyxFQUFDbEMsSUFBSSxHQUFMLEVBQVVHLE1BQU0sSUFBSUMsSUFBSixDQUFTLDBCQUFULENBQWhCLEVBQWxDO0FBQ0FaLG9CQUFNc0MsTUFBTixDQUFhRixLQUFiLEVBQW1CLE1BQU16QyxRQUFRZ0QsWUFBUixDQUFxQixDQUFyQixDQUF6QixHQUFrRCxJQUFJL0IsSUFBSixDQUFTLDBCQUFULENBQWxEO0FBQ0FqQixZQUFRK0MsV0FBUixDQUFvQixZQUFwQixFQUFrQyxFQUFDbEMsSUFBSSxHQUFMLEVBQVVHLE1BQU0sSUFBSUMsSUFBSixDQUFTLDBCQUFULENBQWhCLEVBQWxDO0FBQ0FaLG9CQUFNc0MsTUFBTixDQUFhRixLQUFiLEVBQW1CLE1BQU16QyxRQUFRZ0QsWUFBUixDQUFxQixDQUFyQixDQUF6QixHQUFrRCxJQUFJL0IsSUFBSixDQUFTLDBCQUFULENBQWxEO0FBQ0QsR0FURDtBQVdELENBM0xEIiwiZmlsZSI6Im1lbW9yeUhpc3RvcnlTdG9yYWdlLnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBzaG91bGQgZnJvbSAnc2hvdWxkJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgTWVtb3J5SGlzdG9yeVN0b3JhZ2UgZnJvbSAnLi9tZW1vcnlIaXN0b3J5U3RvcmFnZSc7XG5pbXBvcnQgSGlzdG9yeUZpbGVNYW5hZ2VyIGZyb20gJy4vaGlzdG9yeUZpbGVNYW5hZ2VyJztcblxuLyoqXG4gKiBAdGVzdCB7TWVtb3J5SGlzdG9yeVN0b3JhZ2V9XG4gKi9cbmRlc2NyaWJlKCdNZW1vcnlIaXN0b3J5U3RvcmFnZScsICgpID0+IHtcblxuICBsZXQgc3RvcmFnZTtcbiAgbGV0IHRlc3REZWFsO1xuICBsZXQgdGVzdE9yZGVyO1xuICBsZXQgc2FuZGJveDtcblxuICBiZWZvcmUoKCkgPT4ge1xuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIHNhbmRib3guc3R1YihIaXN0b3J5RmlsZU1hbmFnZXIucHJvdG90eXBlLCAnc3RhcnRVcGRhdGVKb2InKS5yZXR1cm5zKCk7XG4gICAgc3RvcmFnZSA9IG5ldyBNZW1vcnlIaXN0b3J5U3RvcmFnZSgnYWNjb3VudElkJyk7XG4gICAgdGVzdERlYWwgPSB7aWQ6JzM3ODYzNjQzJywgdHlwZTonREVBTF9UWVBFX0JBTEFOQ0UnLCBtYWdpYzowLCB0aW1lOiBuZXcgRGF0ZSgxMDApLCBjb21taXNzaW9uOjAsIFxuICAgICAgc3dhcDowLCBwcm9maXQ6MTAwMDAsIHBsYXRmb3JtOidtdDUnLCBjb21tZW50OidEZW1vIGRlcG9zaXQgMSd9O1xuICAgIHRlc3RPcmRlciA9IHtpZDonNjEyMTA0NjMnLCB0eXBlOidPUkRFUl9UWVBFX1NFTEwnLCBzdGF0ZTonT1JERVJfU1RBVEVfRklMTEVEJywgc3ltYm9sOidBVUROWkQnLCBtYWdpYzowLCBcbiAgICAgIHRpbWU6IG5ldyBEYXRlKDUwKSwgZG9uZVRpbWU6IG5ldyBEYXRlKDEwMCksIGN1cnJlbnRQcmljZToxLCB2b2x1bWU6MC4wMSwgXG4gICAgICBjdXJyZW50Vm9sdW1lOjAsIHBvc2l0aW9uSWQ6JzYxMjA2NjMwJywgcGxhdGZvcm06J210NScsIGNvbW1lbnQ6J0FTX0FVRE5aRF81WXlNNktTN0Z2Oid9O1xuICAgIGF3YWl0IHN0b3JhZ2UuY2xlYXIoKTtcbiAgICBzdG9yYWdlLm9uQ29ubmVjdGVkKCcxOnBzLW1wYS0xJywgMSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEB0ZXN0IHtNZW1vcnlIaXN0b3J5U3RvcmFnZSNsb2FkRGF0YUZyb21EaXNrfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCBsb2FkIGRhdGEgZnJvbSB0aGUgZmlsZSBtYW5hZ2VyJywgYXN5bmMgKCkgPT4ge1xuICAgIHNhbmRib3guc3R1YihIaXN0b3J5RmlsZU1hbmFnZXIucHJvdG90eXBlLCAnZ2V0SGlzdG9yeUZyb21EaXNrJylcbiAgICAgIC5yZXR1cm5zKHtkZWFsczogW3Rlc3REZWFsXSwgaGlzdG9yeU9yZGVyczogW3Rlc3RPcmRlcl19KTtcbiAgICBhd2FpdCBzdG9yYWdlLmxvYWREYXRhRnJvbURpc2soKTtcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIDUwKSk7XG4gICAgc3RvcmFnZS5kZWFscy5zaG91bGQubWF0Y2goW3Rlc3REZWFsXSk7XG4gICAgc3RvcmFnZS5oaXN0b3J5T3JkZXJzLnNob3VsZC5tYXRjaChbdGVzdE9yZGVyXSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7TWVtb3J5SGlzdG9yeVN0b3JhZ2UjdXBkYXRlRGlza1N0b3JhZ2V9XG4gICAqL1xuICBpdCgnc2hvdWxkIHVwZGF0ZSBkaXNrIHN0b3JhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgc2FuZGJveC5zdHViKEhpc3RvcnlGaWxlTWFuYWdlci5wcm90b3R5cGUsICd1cGRhdGVEaXNrU3RvcmFnZScpO1xuICAgIGF3YWl0IHN0b3JhZ2UudXBkYXRlRGlza1N0b3JhZ2UoKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZShIaXN0b3J5RmlsZU1hbmFnZXIucHJvdG90eXBlLnVwZGF0ZURpc2tTdG9yYWdlKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZW1vcnlIaXN0b3J5U3RvcmFnZSNsYXN0SGlzdG9yeU9yZGVyVGltZX1cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0dXJuIGxhc3QgaGlzdG9yeSBvcmRlciB0aW1lJywgKCkgPT4ge1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHt9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7ZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKX0pO1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDJUMDA6MDA6MDAuMDAwWicpfSk7XG4gICAgc3RvcmFnZS5sYXN0SGlzdG9yeU9yZGVyVGltZSgpLnNob3VsZC5tYXRjaChuZXcgRGF0ZSgnMjAyMC0wMS0wMlQwMDowMDowMC4wMDBaJykpO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01lbW9yeUhpc3RvcnlTdG9yYWdlI2xhc3REZWFsVGltZX1cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0dXJuIGxhc3QgaGlzdG9yeSBkZWFsIHRpbWUnLCAoKSA9PiB7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHt9KTtcbiAgICBzdG9yYWdlLm9uRGVhbEFkZGVkKCcxOnBzLW1wYS0xJywge3RpbWU6IG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKX0pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7dGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDJUMDA6MDA6MDAuMDAwWicpfSk7XG4gICAgc3RvcmFnZS5sYXN0RGVhbFRpbWUoKS5zaG91bGQubWF0Y2gobmV3IERhdGUoJzIwMjAtMDEtMDJUMDA6MDA6MDAuMDAwWicpKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZW1vcnlIaXN0b3J5U3RvcmFnZSNkZWFsc31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0dXJuIHNhdmVkIGRlYWxzJywgKCkgPT4ge1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxJywgdGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzcnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wNS0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICc4JywgdGltZTogbmV3IERhdGUoJzIwMjAtMDItMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzYnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0xMC0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICc0JywgdGltZTogbmV3IERhdGUoJzIwMjAtMDItMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzUnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wNi0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxMScsIHR5cGU6ICdERUFMX1RZUEVfU0VMTCd9KTtcbiAgICBzdG9yYWdlLm9uRGVhbEFkZGVkKCcxOnBzLW1wYS0xJywge2lkOiAnMycsIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA5LTAxVDAwOjAwOjAwLjAwMFonKSwgdHlwZTogJ0RFQUxfVFlQRV9CVVknfSk7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzUnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wNi0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcyJywgdGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkRlYWxBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzEwJywgdHlwZTogJ0RFQUxfVFlQRV9TRUxMJ30pO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxMicsIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2UuZGVhbHMuc2hvdWxkLm1hdGNoKFtcbiAgICAgIHtpZDogJzEwJywgdHlwZTogJ0RFQUxfVFlQRV9TRUxMJ30sXG4gICAgICB7aWQ6ICcxMScsIHR5cGU6ICdERUFMX1RZUEVfU0VMTCd9LFxuICAgICAge2lkOiAnMTInLCB0eXBlOiAnREVBTF9UWVBFX0JVWSd9LFxuICAgICAge2lkOiAnMScsIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKSwgdHlwZTogJ0RFQUxfVFlQRV9TRUxMJ30sXG4gICAgICB7aWQ6ICc0JywgdGltZTogbmV3IERhdGUoJzIwMjAtMDItMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSxcbiAgICAgIHtpZDogJzgnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wMi0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfU0VMTCd9LFxuICAgICAge2lkOiAnNycsIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTA1LTAxVDAwOjAwOjAwLjAwMFonKSwgdHlwZTogJ0RFQUxfVFlQRV9CVVknfSxcbiAgICAgIHtpZDogJzUnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wNi0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30sXG4gICAgICB7aWQ6ICcyJywgdGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSxcbiAgICAgIHtpZDogJzMnLCB0aW1lOiBuZXcgRGF0ZSgnMjAyMC0wOS0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdERUFMX1RZUEVfQlVZJ30sXG4gICAgICB7aWQ6ICc2JywgdGltZTogbmV3IERhdGUoJzIwMjAtMTAtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX0JVWSd9XG4gICAgXSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7TWVtb3J5SGlzdG9yeVN0b3JhZ2UjaGlzdG9yeU9yZGVyc31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0dXJuIHNhdmVkIGhpc3RvcnlPcmRlcnMnLCAoKSA9PiB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzEnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWicpLFxuICAgICAgdHlwZTogJ09SREVSX1RZUEVfU0VMTCd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICc3JywgZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTA1LTAxVDAwOjAwOjAwLjAwMFonKSxcbiAgICAgIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICc4JywgZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTAyLTAxVDAwOjAwOjAwLjAwMFonKSwgXG4gICAgICB0eXBlOiAnT1JERVJfVFlQRV9TRUxMJ30pO1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzYnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMTAtMDFUMDA6MDA6MDAuMDAwWicpLCBcbiAgICAgIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICc0JywgZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTAyLTAxVDAwOjAwOjAwLjAwMFonKSwgXG4gICAgICB0eXBlOiAnT1JERVJfVFlQRV9TRUxMJ30pO1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzUnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDYtMDFUMDA6MDA6MDAuMDAwWicpLCBcbiAgICAgIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxMScsIHR5cGU6ICdPUkRFUl9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkhpc3RvcnlPcmRlckFkZGVkKCcxOnBzLW1wYS0xJywge2lkOiAnMycsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOS0wMVQwMDowMDowMC4wMDBaJyksIFxuICAgICAgdHlwZTogJ09SREVSX1RZUEVfQlVZJ30pO1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzUnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDYtMDFUMDA6MDA6MDAuMDAwWicpLCBcbiAgICAgIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcyJywgZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTAxVDAwOjAwOjAwLjAwMFonKSwgXG4gICAgICB0eXBlOiAnT1JERVJfVFlQRV9TRUxMJ30pO1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzEwJywgdHlwZTogJ09SREVSX1RZUEVfU0VMTCd9KTtcbiAgICBzdG9yYWdlLm9uSGlzdG9yeU9yZGVyQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxMicsIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9KTtcbiAgICBzdG9yYWdlLmhpc3RvcnlPcmRlcnMuc2hvdWxkLm1hdGNoKFtcbiAgICAgIHtpZDogJzEwJywgdHlwZTogJ09SREVSX1RZUEVfU0VMTCd9LFxuICAgICAge2lkOiAnMTEnLCB0eXBlOiAnT1JERVJfVFlQRV9TRUxMJ30sXG4gICAgICB7aWQ6ICcxMicsIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9LFxuICAgICAge2lkOiAnMScsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdPUkRFUl9UWVBFX1NFTEwnfSxcbiAgICAgIHtpZDogJzQnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDItMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnT1JERVJfVFlQRV9TRUxMJ30sXG4gICAgICB7aWQ6ICc4JywgZG9uZVRpbWU6IG5ldyBEYXRlKCcyMDIwLTAyLTAxVDAwOjAwOjAwLjAwMFonKSwgdHlwZTogJ09SREVSX1RZUEVfU0VMTCd9LFxuICAgICAge2lkOiAnNycsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wNS0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9LFxuICAgICAge2lkOiAnNScsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wNi0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdPUkRFUl9UWVBFX0JVWSd9LFxuICAgICAge2lkOiAnMicsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wOC0wMVQwMDowMDowMC4wMDBaJyksIHR5cGU6ICdPUkRFUl9UWVBFX1NFTEwnfSxcbiAgICAgIHtpZDogJzMnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDktMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnT1JERVJfVFlQRV9CVVknfSxcbiAgICAgIHtpZDogJzYnLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMTAtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnT1JERVJfVFlQRV9CVVknfVxuICAgIF0pO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01lbW9yeUhpc3RvcnlTdG9yYWdlI29yZGVyU3luY2hyb25pemF0aW9uRmluaXNoZWR9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHVybiBzYXZlZCBvcmRlciBzeW5jaHJvbml6YXRpb24gc3RhdHVzJywgKCkgPT4ge1xuICAgIHN0b3JhZ2Uub3JkZXJTeW5jaHJvbml6YXRpb25GaW5pc2hlZC5zaG91bGQuYmUuZmFsc2UoKTtcbiAgICBzdG9yYWdlLm9uT3JkZXJTeW5jaHJvbml6YXRpb25GaW5pc2hlZCgxKTtcbiAgICBzdG9yYWdlLm9yZGVyU3luY2hyb25pemF0aW9uRmluaXNoZWQuc2hvdWxkLmJlLnRydWUoKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZW1vcnlIaXN0b3J5U3RvcmFnZSNkZWFsU3luY2hyb25pemF0aW9uRmluaXNoZWR9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHVybiBzYXZlZCBkZWFsIHN5bmNocm9uaXphdGlvbiBzdGF0dXMnLCAoKSA9PiB7XG4gICAgc3RvcmFnZS5fZmlsZU1hbmFnZXIudXBkYXRlRGlza1N0b3JhZ2UgPSBzYW5kYm94LnN0dWIoKTtcbiAgICBzdG9yYWdlLmRlYWxTeW5jaHJvbml6YXRpb25GaW5pc2hlZC5zaG91bGQuYmUuZmFsc2UoKTtcbiAgICBzdG9yYWdlLm9uRGVhbFN5bmNocm9uaXphdGlvbkZpbmlzaGVkKDEpO1xuICAgIHNpbm9uLmFzc2VydC5jYWxsZWRPbmNlKHN0b3JhZ2UuX2ZpbGVNYW5hZ2VyLnVwZGF0ZURpc2tTdG9yYWdlKTtcbiAgICBzdG9yYWdlLmRlYWxTeW5jaHJvbml6YXRpb25GaW5pc2hlZC5zaG91bGQuYmUudHJ1ZSgpO1xuICB9KTtcblxuICAvKipcbiAgICogQHRlc3Qge01lbW9yeUhpc3RvcnlTdG9yYWdlI3Jlc2V0fVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXNldCBzdG9yYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgIHNhbmRib3guc3R1YihzdG9yYWdlLl9maWxlTWFuYWdlciwgJ2RlbGV0ZVN0b3JhZ2VGcm9tRGlzaycpO1xuICAgIHN0b3JhZ2Uub25EZWFsQWRkZWQoJzE6cHMtbXBhLTEnLCB7aWQ6ICcxJywgdGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWicpLCB0eXBlOiAnREVBTF9UWVBFX1NFTEwnfSk7XG4gICAgc3RvcmFnZS5vbkhpc3RvcnlPcmRlckFkZGVkKCcxOnBzLW1wYS0xJywge2lkOiAnMScsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMVQwMDowMDowMC4wMDBaJyksIFxuICAgICAgdHlwZTogJ09SREVSX1RZUEVfU0VMTCd9KTtcbiAgICBhd2FpdCBzdG9yYWdlLmNsZWFyKCk7XG4gICAgc2lub24uYXNzZXJ0Lm1hdGNoKHN0b3JhZ2UuZGVhbHMsIFtdKTtcbiAgICBzaW5vbi5hc3NlcnQubWF0Y2goc3RvcmFnZS5oaXN0b3J5T3JkZXJzLCBbXSk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2Uoc3RvcmFnZS5fZmlsZU1hbmFnZXIuZGVsZXRlU3RvcmFnZUZyb21EaXNrKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtNZW1vcnlIaXN0b3J5U3RvcmFnZSNyZXNldH1cbiAgICovXG4gIGl0KCdzaG91bGQgcmVjb3JkIGluc3RhbmNlIGRhdGEgZnJvbSBtdWx0aXBsZSBzdHJlYW1zJywgYXN5bmMgKCkgPT4ge1xuICAgIHN0b3JhZ2Uub25IaXN0b3J5T3JkZXJBZGRlZCgnMTpwcy1tcGEtMScsIHtpZDogJzInLCBkb25lVGltZTogbmV3IERhdGUoJzIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWicpfSk7XG4gICAgc2lub24uYXNzZXJ0Lm1hdGNoKGF3YWl0IHN0b3JhZ2UubGFzdEhpc3RvcnlPcmRlclRpbWUoMSksIG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKSk7XG4gICAgc3RvcmFnZS5vbkhpc3RvcnlPcmRlckFkZGVkKCcxOnBzLW1wYS0yJywge2lkOiAnMycsIGRvbmVUaW1lOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMlQwMDowMDowMC4wMDBaJyl9KTtcbiAgICBzaW5vbi5hc3NlcnQubWF0Y2goYXdhaXQgc3RvcmFnZS5sYXN0SGlzdG9yeU9yZGVyVGltZSgxKSwgbmV3IERhdGUoJzIwMjAtMDEtMDJUMDA6MDA6MDAuMDAwWicpKTtcbiAgICBzdG9yYWdlLm9uRGVhbEFkZGVkKCcxOnBzLW1wYS0xJywge2lkOiAnMicsIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKX0pO1xuICAgIHNpbm9uLmFzc2VydC5tYXRjaChhd2FpdCBzdG9yYWdlLmxhc3REZWFsVGltZSgxKSwgbmV3IERhdGUoJzIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWicpKTtcbiAgICBzdG9yYWdlLm9uRGVhbEFkZGVkKCcxOnBzLW1wYS0yJywge2lkOiAnMycsIHRpbWU6IG5ldyBEYXRlKCcyMDIwLTAxLTAyVDAwOjAwOjAwLjAwMFonKX0pO1xuICAgIHNpbm9uLmFzc2VydC5tYXRjaChhd2FpdCBzdG9yYWdlLmxhc3REZWFsVGltZSgxKSwgbmV3IERhdGUoJzIwMjAtMDEtMDJUMDA6MDA6MDAuMDAwWicpKTtcbiAgfSk7XG5cbn0pO1xuIl19